# S2C Application Setup Guide

This repository contains the full-stack S2C application (Next.js + Convex). Follow the steps below to prepare your local environment, configure required secrets, enable Google OAuth, and launch the app.

---

## 1. Prerequisites

- **Node.js** ≥ 20 (use `node -v` to confirm)
- **npm** (ships with Node)  
- **Convex CLI**: `npm install -g convex` (or run `npx convex` directly)
- **Google Cloud account** (to create OAuth credentials)
- Optional: Polar account (for billing integration), Anthropic API access (for AI features)

---

## 2. Install Dependencies

```bash
npm install
```

---

## 3. Environment Variables

Create a file named `.env.local` in the project root (same folder as `package.json`). This file is ignored by git and will hold all secrets required by both Next.js and Convex.

> If you already have a `.env.local`, merge the values below with your existing file.

```bash
touch .env.local
```

Add the following keys (replace placeholders with real values):

```env
# --- App URLs ---
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Convex config (created in Step 4)
NEXT_PUBLIC_CONVEX_URL=
CONVEX_SITE_URL=
CONVEX_DEPLOYMENT=
CONVEX_ACCESS_KEY=

# --- Auth Providers ---
AUTH_GOOGLE_ID=
AUTH_GOOGLE_SECRET=

# --- AI Providers ---
ANTHROPIC_API_KEY=

# --- Billing (Polar) ---
# Leave blank if you are not using Polar in development.
POLAR_ENV=sandbox
POLAR_ACCESS_TOKEN=
POLAR_STANDARD_PLAN=
POLAR_WEBHOOK_SECRET=
```

### Variable Description

- `NEXT_PUBLIC_APP_URL`: Base URL where Next.js is reachable (local or production).
- `NEXT_PUBLIC_CONVEX_URL`, `CONVEX_SITE_URL`, `CONVEX_DEPLOYMENT`, `CONVEX_ACCESS_KEY`: Generated by the Convex CLI (next section).
- `AUTH_GOOGLE_ID`, `AUTH_GOOGLE_SECRET`: Google OAuth credentials.
- `ANTHROPIC_API_KEY`: Required for the Claude-based generation endpoints inside `/api/generate/*`.
- `POLAR_*`: Optional but required if you want billing/checkout flows to function. Replace with sandbox or production credentials from Polar.

> Add any other keys specific to your deployment in the same file. Next.js automatically loads `.env.local` for server and client code.

---

## 4. Configure Convex

1. Log in (or sign up) with Convex:
   ```bash
   npx convex login
   ```
2. Initialize or link a project (only needed the first time):
   ```bash
   npx convex init
   ```
   - Follow the prompts to create a development deployment named something like `dev`.
3. Start the Convex dev server once to generate environment values:
   ```bash
   npx convex dev
   ```
   The CLI prints the values needed for:
   - `NEXT_PUBLIC_CONVEX_URL`
   - `CONVEX_SITE_URL`
   - `CONVEX_DEPLOYMENT`
   - `CONVEX_ACCESS_KEY`

   Copy the values into `.env.local`. Leave the dev server running in a separate terminal while developing.

---

## 5. Enable Google OAuth

1. Visit <https://console.cloud.google.com/> and create (or open) a project.
2. Go to **APIs & Services → OAuth consent screen**:
   - Configure the consent screen (External or Internal).
   - Add your application name and domain.
3. Go to **APIs & Services → Credentials → Create Credentials → OAuth client ID**.
4. Choose **Web application**.
5. Add authorized JavaScript origins:
   - `http://localhost:3000`
   - (Add your production URL later, e.g., `https://app.example.com`)
6. Add authorized redirect URIs:
   - `http://localhost:3000/api/auth/callback/google`
   - (Add the production equivalent when ready)
7. Save and copy the **Client ID** and **Client secret** and set:
   ```env
   AUTH_GOOGLE_ID=your-google-client-id
   AUTH_GOOGLE_SECRET=your-google-client-secret
   ```
8. If you run production builds, add the production URLs to Google’s OAuth settings and update `NEXT_PUBLIC_APP_URL` accordingly.

> Once configured, users can sign in with Google via the `ConvexAuthNextjsProvider`.

---

## 6. Start the App

Run both the Convex dev server and the Next.js dev server (two terminals):

```bash
# Terminal 1 - Convex (keeps the backend & auth running)
npx convex dev

# Terminal 2 - Next.js frontend
npm run dev
```

- Next.js listens on `http://localhost:3000`.
- Convex listens on the port printed by the CLI (commonly `localhost:8187`); the frontend connects via `NEXT_PUBLIC_CONVEX_URL`.

---

## 7. Optional: Billing Webhooks (Polar)

If you plan to test billing flows locally:

1. Create a Polar sandbox account.
2. Configure a product/plan and copy the API token + plan ID into `POLAR_ACCESS_TOKEN` and `POLAR_STANDARD_PLAN`.
3. Create a webhook endpoint in Polar that points to:
   ```
   https://<your-ngrok-subdomain>/api/billing/webhook
   ```
   (Use a tunnel like `ngrok` for local development.)
4. Set the webhook secret in `POLAR_WEBHOOK_SECRET`.
5. Toggle `POLAR_ENV=sandbox` for development; use `production` when going live.

---

## 8. Production Deployment Checklist

- Configure all environment variables in your hosting provider.
- Update `NEXT_PUBLIC_APP_URL` and Google OAuth redirect URIs to match your production domain.
- Provision production Convex deployment (`npx convex deploy`) and update the Convex variables from the CLI output.
- Update Polar credentials to production mode (if used).

---

## 9. Troubleshooting Tips

- Missing Convex variables → rerun `npx convex dev` and copy values.
- OAuth errors → double-check redirect URIs in Google Cloud.
- `ANTHROPIC_API_KEY` missing → AI endpoints return 401/500; ensure the key is set and has access to the required Claude models.
- Webhook signature errors → confirm `POLAR_WEBHOOK_SECRET` matches the value shown in Polar.

---

With the `.env.local` configured and both servers running, you should be able to sign in with Google, access the dashboard, and exercise the full S2C experience locally. Reach out if you need extra configuration details. Happy building!





